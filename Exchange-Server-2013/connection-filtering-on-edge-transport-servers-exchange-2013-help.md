---
title: '边缘传输服务器上的连接筛选: Exchange 2013 Help'
TOCTitle: 边缘传输服务器上的连接筛选
ms:assetid: b513755c-5d3e-44fa-a6cb-771d48b544ac
ms:mtpsurl: https://technet.microsoft.com/zh-cn/library/Bb124320(v=EXCHG.150)
ms:contentKeyID: 60829994
ms.date: 05/21/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# 边缘传输服务器上的连接筛选

 

_**适用于：**Exchange Server 2013_

_**上一次修改主题：**2015-03-09_

连接筛选是 Microsoft Exchange Server 2013 中的反垃圾邮件功能，该功能可根据邮件来源允许或阻止电子邮件。连接筛选由仅在边缘传输服务器上可用的连接筛选代理执行。连接筛选代理依赖于连接邮件服务器的 IP 地址，以确定对入站邮件执行哪些操作（如果有）。

默认情况下，连接筛选代理是评估边缘传输服务器上的入站邮件的首个反垃圾邮件代理。系统将对照允许和阻止的 IP 地址检查 SMTP 连接的源 IP 地址。如果明确允许了源 IP 地址，则邮件将发送给组织中的收件人，而其他反垃圾邮件代理不会进行额外的处理。如果明确阻止了源 IP 地址，则 SMTP 连接会断开。如果未明确允许或阻止源 IP 地址，邮件将流经边缘传输服务器上的其他反垃圾邮件代理。

连接筛选将源邮件服务器的 IP 地址与 IP 允许列表、IP 阻止列表、IP 允许列表提供程序及 IP 阻止列表提供程序中的值进行比较。您至少需要配置这四个 IP 地址数据存储中的一个，连接筛选才能正常运行。如果未指定任何 IP 地址数据，则应禁用连接筛选代理。有关详细信息，请参阅[管理边缘传输服务器上的连接筛选](manage-connection-filtering-on-edge-transport-servers-exchange-2013-help.md)。

**目录**

IP Block list

IP Allow list

IP Block List providers

IP Allow List providers

Test IP Block List providers and IP Allow List providers

Configure connection filtering on Edge Transport servers that aren't directly connected to the Internet

## IP 阻止列表

IP 阻止列表包含您要阻止的电子邮件服务器的 IP 地址。您可手动维护 IP 阻止列表中的 IP 地址。您可以添加单个 IP 地址或 IP 地址范围。您可以指定一个过期时间，该时间将指定阻止 IP 地址条目的时长。到达过期时间后，将禁用 IP 阻止列表中的 IP 地址条目。

如果连接筛选代理发现源 IP 地址在 IP 阻止列表中列出，则在处理完邮件中的所有 **RCPT TO** 邮件头（信封收件人）后，SMTP 连接将断开。

还可以通过协议分析代理的发件人信誉功能将 IP 地址自动添加到 IP 阻止列表中。有关详细信息，请参阅[发件人信誉和协议分析代理](sender-reputation-and-the-protocol-analysis-agent-exchange-2013-help.md)。

## IP 允许列表

IP 允许列表包含您要指定为电子邮件可信来源的电子邮件服务器的 IP 地址。来自您在 IP 允许列表中指定的邮件服务器的电子邮件将免于由其他 Exchange 反垃圾邮件代理进行处理。

您可手动维护 IP 允许列表中的 IP 地址。您可以添加单个 IP 地址或 IP 地址范围。您可以指定一个过期时间，该时间将指定允许 IP 地址条目的时长。到达过期时间后，将禁用 IP 允许列表中的条目。

返回顶部

## IP 阻止列表提供程序

IP 阻止列表提供程序通常称为*实时阻止列表*或 RBL。IP 阻止列表提供程序将编译发送垃圾邮件的邮件服务器 IP 地址列表。很多 IP 阻止列表提供程序还将编译可用于垃圾邮件的邮件服务器 IP 地址列表。示例包括为开放中继配置的邮件服务器、分配动态 IP 地址的 Internet 服务提供商 (ISP)，以及允许来自拨号帐户的 SMTP 邮件服务器通信的 ISP。

配置连接筛选以使用 IP 阻止列表提供程序时，连接筛选代理会将连接邮件服务器的 IP 地址与 IP 阻止列表提供程序的 IP 地址列表进行比较。如果匹配，则在组织中不允许该邮件。您可以配置连接筛选以使用多个 IP 阻止列表提供程序，并为每个提供程序分配不同的优先级值。

连接筛选代理将在 IP 允许列表和 IP 阻止列表中检查源 IP 地址。如果 IP 地址不存在于这两个列表中，连接筛选代理将根据您分配的优先级值查询 IP 阻止列表提供程序。如果已在 IP 阻止列表提供程序中定义了 IP 地址，边缘传输服务器会等待并处理 **RCPT TO** 邮件头，通过使用 `SMTP 550` 错误对发送邮件服务器作出响应，并关闭连接。连接不会立即断开，以便可以记录连接尝试，以及指定其邮件将免于被任何 IP 阻止列表提供程序阻止的收件人。

如果未在任何 IP 阻止列表提供程序中定义 IP 地址，内容筛选代理会将邮件转交给边缘传输服务器上的下一个传输代理。

对于每个 IP 阻止列表提供程序，您可以自定义在邮件被阻止时返回给发件人的 `SMTP 550` 错误。您应确定将邮件来源标识为垃圾邮件的 IP 阻止列表提供程序。如果合法的源邮件服务器被错误地标识为垃圾邮件来源，管理员可以联系 IP 阻止列表提供程序，并执行必要的步骤，以从 IP 阻止列表提供程序中删除该邮件服务器。

IP 阻止列表提供程序可以返回不同的代码，以确定将 IP 地址定义到其列表中的原因。大部分 IP 阻止列表提供程序将返回位掩码或绝对值数据类型。在这些数据类型中，IP 阻止列表提供程序可以使用多个值按威胁类型对 IP 地址进行分类。

使用 IP 阻止列表提供程序时需要考虑以下问题：

  - IP 阻止列表提供程序服务的中断或延迟可能会导致边缘传输服务器上的邮件处理发生延迟。您应始终选择可靠的 IP 阻止列表提供程序。

  - 已知是合法的源服务器可能会被错误地标识为垃圾邮件来源。例如，可能会在无意中将邮件服务器配置为充当开放中继。您应始终选择可提供有关其服务中的评估和删除事项的明确步骤的 IP 阻止列表提供程序。

返回顶部

## 位掩码和绝对值示例

此节显示大多数阻止列表提供程序返回的状态代码示例。有关提供程序返回的状态代码的详细信息，请参阅特定提供程序中的文档。

对于位掩码数据类型，IP 阻止列表提供程序服务返回状态代码 127.0.0.*x*，其中整数 *x* 是下表中列出的任一值。

### 位掩码数据类型的值和状态代码

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>值</th>
<th>状态代码</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>1</p></td>
<td><p>该 IP 地址在 IP 阻止列表中。</p></td>
</tr>
<tr class="even">
<td><p>2</p></td>
<td><p>SMTP 服务器配置为充当开放中继。</p></td>
</tr>
<tr class="odd">
<td><p>4</p></td>
<td><p>该 IP 地址支持拨号 IP 地址。</p></td>
</tr>
</tbody>
</table>


对于绝对值类型，IP 阻止列表提供程序将返回明确响应，该响应将详细说明在其阻止列表中定义 IP 地址的原因。下表显示绝对值和明确响应的一些示例。

### 绝对值数据类型的值和状态代码

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>值</th>
<th>明确响应</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>127.0.0.2</p></td>
<td><p>该 IP 地址是直接垃圾邮件来源。</p></td>
</tr>
<tr class="even">
<td><p>127.0.0.4</p></td>
<td><p>该 IP 地址是邮件群发程序。</p></td>
</tr>
<tr class="odd">
<td><p>127.0.0.5</p></td>
<td><p>发送邮件的远程服务器可以支持多阶段开放中继。</p></td>
</tr>
</tbody>
</table>


返回顶部

## IP 允许列表提供程序

IP 允许列表提供程序也称为*安全列表*或*白名单*。IP 允许列表提供程序的配置方式与 IP 阻止列表提供程序类似，但结果截然相反：IP 允许列表提供程序定义与垃圾邮件活动绝对不相关的邮件服务器 IP 地址。如果已在 IP 允许列表提供程序中定义了连接邮件服务器的 IP 地址，邮件将免于由其他 Exchange 反垃圾邮件代理进行处理。正因如此，IP 阻止列表提供程序要比 IP 允许列表提供程序使用得频繁得多。请谨慎选择 IP 允许列表提供程序。

返回顶部

## 测试 IP 阻止列表提供程序和 IP 允许列表提供程序

将连接筛选配置为使用 IP 阻止列表提供程序或 IP 允许列表提供程序之后，可以运行测试来验证提供程序是否正常运行。大部分提供程序都提供可用于测试其服务的测试 IP 地址。测试提供程序时，连接筛选代理会发出 DNS 查询，它的结果应是提供程序作出特定响应。有关如何对 IP 阻止列表提供程序服务或 IP 允许列表提供程序服务测试 IP 地址的详细信息，请参阅[管理边缘传输服务器上的连接筛选](manage-connection-filtering-on-edge-transport-servers-exchange-2013-help.md)。

返回顶部

## 在不直接连接 Internet 的边缘传输服务器上配置连接筛选

您可以在不直接接收来自 Internet 的电子邮件的边缘传输服务器上使用连接筛选在此情况下，边缘传输服务器在其他直接接收和处理来自 Internet 的邮件的邮件服务器的后面。例如，在邮件到达边缘传输服务器之前，您的组织可能会通过反垃圾邮件服务器、服务或设备发送电子邮件通信。在此情况下，连接筛选器代理需要从邮件中提取正确的源 IP 地址。为此，连接筛选代理需要分析邮件头中的 **Received** 邮件头字段值，并将这些值与位于边缘传输服务器和 Internet 之间的邮件服务器的已知 IP 地址进行比较。

接受并沿传递路径中继 SMTP 邮件的每个邮件服务器都会在邮件头中添加自己的 **Received** 邮件头字段。**Received** 邮件头通常包含处理邮件的邮件服务器的域名和 IP 地址。

如果边缘传输服务器不接受直接来自 Internet 的邮件，则您需要使用 Exchange 2013 邮箱服务器上 **Set-TransportConfig** cmdlet 中的 *InternalSMTPServers* 参数来确定位于边缘传输服务器和 Internet 之间的邮件服务器的 IP 地址。EdgeSync 将 IP 地址数据复制到边缘传输服务器上。边缘传输服务器接收邮件后，连接筛选代理假定 **Received** 邮件头字段中不与由 *InternalSMTPServers* 参数指定的值相匹配的 IP 地址是需要检查的源 IP 地址。因此，您需要指定所有内部 SMTP 服务器，这样连接筛选才能正常运行。

返回顶部

